<div id="content">
  <div class="filter-col p-3" data-simplebar>
    <h6 class="mt-3 font-weight-bold">Filter Options</h6>
    <div class="mt-4 d-flex justify-content-around">
      <div class="d-flex flex-column align-items-center">
        <a href="javascript:void(0);" class="data-action" data-target="#loadFilterModal" data-toggle="modal">
          <i class="fa fa-upload"></i></a>
        <span class="text-muted">Load</span>
      </div>
      <div class="d-flex flex-column align-items-center">
        <a href="javascript:void(0);" class="data-action" data-target="#saveFilterModal" data-toggle="modal"><i
          class="fa fa-download"></i></a>
        <span class="text-muted">Save</span>
      </div>
      <div class="d-flex flex-column align-items-center">
        <a href="javascript:void(0);" class="data-action"><i class="fa fa-list-ul"></i></a>
        <span class="text-muted">Organize</span>
      </div>
    </div>
    <hr>
    <div class="mb-2">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Search">
        <div class="input-group-append">
          <span class="input-group-text"><i class="fa fa-search"></i></span>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <a class="text-muted" href="javascript:void(0);">clear all filters</a>
      </div>
    </div>
    <div class="panel-group mt-1" role="tablist" id="filterAccordion" aria-multiselectable="true">
      <ng-container *ngFor="let filter of filters; let filterIndex=index">
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" [id]="filter.key">
            <h4 class="panel-title">
              <a role="button" data-toggle="collapse" data-parent="#filterAccordion"
                 [href]="'#' + filter.key + 'filter'"
                 aria-expanded="true" [attr.aria-controls]="filter.key + 'filter'"
                 (click)="filter.isExpanded = !filter.isExpanded">
                {{ filter.name }}
                <i class="fa float-right" [ngClass]="[ filter.isExpanded ? 'fa-minus' : 'fa-plus' ]"></i>
              </a>
            </h4>
          </div>
          <div [id]="filter.key + 'filter'" class="panel-collapse collapse" role="tabpanel"
               [attr.aria-labelledby]="filter.key">
            <div class="panel-body">
              <ul class="m-0">
                <li class="d-flex" *ngFor="let value of filter.values;">
                  <div>
                    <input class="mr-1" type="checkbox" [(ngModel)]="value.isChecked"
                           (change)="onFilterCheckBoxChange()">
                  </div>
                  <p class="m-0">{{ value.name }}</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
    <hr>
    <div class="mb-2">
      <div>
        <span style="font-weight: bold">Forecasting Group</span>
        <a class="text-muted float-right" href="javascript:void(0);" (click)="clearAllSKUs()">clear all skus</a>
      </div>
      <div class="input-group mt-2">
        <input type="text" class="form-control" [(ngModel)]="searchText" name="searchSKU" placeholder="Search FG">
        <div class="input-group-append">
          <span class="input-group-text"><i class="fa fa-search"></i></span>
        </div>
      </div>
    </div>
    <div class="mb-2" style="max-height: 300px; overflow: auto;font-size: 12px;" data-simplebar>
      <div class="bg-white mt-1 p-1 pl-2 d-flex" *ngFor="let sku of skus | filter: getCallback(); let i=index">
        <div style="margin-top: 3px;">
          <input class="mr-1" type="checkbox" [(ngModel)]="sku.isChecked" (change)="onFilterCheckBoxChange()">
        </div>
        <p class="m-0">{{ sku.name }}</p>
      </div>
    </div>
  </div>
  <div class="row content-col mb-2">
    <div class="col-12 pl-2 pr-1">
      <div class="bg-white rounded shadow mt-2">
        <div class="d-flex justify-content-between align-items-center p-1">
          <div class="d-flex justify-content-between align-items-center ml-2 pt-2">
            <p class="font-weight-bold">Forecast Analysis</p>
            <p class="ml-2 text-muted">Load Week 201937</p>


            <!-- <p class="ml-2 text-muted">Load Week 25</p> -->
          </div>
          <div>
          </div>
          <div class="d-flex justify-content-around align-items-center">
            <div class="form-group m-0 mr-3">
              <select class="form-control p-0 pr-1" name="plant">
                <option selected>Weekly View</option>
                <option>Monthly View</option>
                <option>Calendar Year View</option>
              </select>
            </div>
            <div class="mr-2">
              <button type="button" class="btn btn-light font-xs p-1" (click)="onChangeHorizonClick()">Change Horizon</button>
            </div>
          </div>
        </div>

        <div id="chartContainer1" style="height: 370px; width: 100%; margin-left:auto;margin-right:auto;"></div>
      </div>

      <div class="bg-white rounded shadow mt-2">
        <div class="d-flex justify-content-between pt-1 pr-1">
          <p class="font-weight-bold ml-2 pt-2">Feature Analysis </p>
          <div class="form-group m-0">
            <select name="plant" #t class="minimal form-control p-0 pr-1" (change)="test(t.value)">
              <option selected value="Baseline">Baseline</option>
              <option value="Promo">Promo Effect</option>
              <option value="Weather">Weather effect</option>
            </select>
          </div>
        </div>
        <div id="chartContainer2" style="height: 150px; width: 100%; margin-left:auto;margin-right:auto;">

        </div>
        <div class="data-strip d-none">
          <ul>
            <li>201910</li>
            <li>201915</li>
            <li>201920</li>
            <li>201925</li>
            <li>201930</li>
            <li>201935</li>
            <li>201940</li>
          </ul>
        </div>
      </div>

      <div class="bg-white shadow mt-2">
        <div class="d-flex">
          <div class="table-header-col">
            <table>
              <thead>
              <tr class="header-text invisible">
                <th class="font-weight-bold">
                  <p class="m-0 week-block"> XXXX</p>
                </th>
              </tr>
              <tr class="header-text" >
                <th class="font-weight-bold">
                  <p class="m-0 week-block">Final Forecast</p>
                </th>
              </tr>
              <tr class="header-text">
                <th class="font-weight-bold">
                  <p class="m-0 week-block">Fcst Value</p>
                </th>
              </tr>
              <tr (click)="putValueInFinal('ML')" class="ml-text">
                <th class="font-weight-bold">
                  <p class="m-0 week-block"> ML Forecast</p>
                </th>
              </tr>
              <tr (click)="putValueInFinal('APO')" class="aop-text">
                <th class="font-weight-bold">
                  <p class="m-0 week-block">APO Forecast</p>
                </th>
              </tr>
              <tr class="actual-text">
                <th class="font-weight-bold">
                  <p class="m-0 week-block">Actuals</p>
                </th>
              </tr>
              <tr class="header-text">
                <th class="font-weight-bold">
                  <p class="m-0 week-block">Actuals LY</p>
                </th>
              </tr>
              </thead>
            </table>
          </div>
          <div class="table-content-col">
            <div class="panel panel-default">
              <div class="center-block fix-width scroll-inner">
                <table class="table table-striped">
                  <thead>
                  <tr>
                    <th class="font-weight-bold" *ngFor="let data of graphData">
                      <p class="m-0 week-block" [class.highlight]="data.comments?.length">  {{data.newweek}}</p>
                    </th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr>
                    <ng-container *ngFor="let data of graphData; let i=index">
                      <td class="font-weight-bold cursor-pointer"
                          [ngClass]="{ 'colored-td': data.calenderYearWeek >= createPlanRequestData.startWeek }"
                          (click)="selectedWeekComments=graphData[i].comments">
                        {{ data.finalForecast }}
                      </td>
                    </ng-container>
                  </tr>
                  <tr>
                    <ng-container *ngFor="let data of graphData; let i=index">
                      <td (dblclick)="data.ml !== undefined && onDblClickInput(i)"
                          [ngClass]="{ 'colored-td': data.calenderYearWeek >= createPlanRequestData.startWeek }">
                        <input type="text" class="table-inputbox" (blur)="onValueBlur(data.calenderYearWeek, i)"
                               [ngClass]="{ 'colored-table-inputbox': data.calenderYearWeek >= createPlanRequestData.startWeek }"
                               (input)="onValueInput(data.calenderYearWeek, i)" [disabled]="data.ml === undefined"
                               [class.disabled]="data.ml === undefined"
                               [(ngModel)]="data.fcstValueAdd">
                      </td>
                    </ng-container>
                  </tr>
                  <tr>
                    <td *ngFor="let data of graphData"
                        [ngClass]="{ 'colored-td': data.calenderYearWeek >= createPlanRequestData.startWeek }">
                      {{ data.ml }}
                    </td>
                  </tr>
                  <tr>
                    <td *ngFor="let data of graphData"
                        [ngClass]="{ 'colored-td': data.calenderYearWeek >= createPlanRequestData.startWeek }">
                      {{ data.apo }}
                    </td>
                  </tr>
                  <tr>
                    <td *ngFor="let data of graphData"
                        [ngClass]="{ 'colored-td': data.calenderYearWeek >= createPlanRequestData.startWeek }">
                      {{ data.actuals }}
                    </td>
                  </tr>
                  <tr>
                    <td *ngFor="let data of graphData"
                        [ngClass]="{ 'colored-td': data.calenderYearWeek >= createPlanRequestData.startWeek }">
                      {{ data.actualslastyear }}
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="table-footer-col">
            <table>
              <tr>
                <th class="font-weight-bold">
                  <p class="m-0 week-block">Total</p>
                </th>
              </tr>
              <tr>
                <th class="font-weight-bold">
                  <p class="m-0 week-block">{{ totalData.finalCastTotal }}</p>
                </th>
              </tr>
              <tr>
                <th class="font-weight-bold">
                  <p class="m-0 week-block">{{ totalData.fcstValueAdd || 0 }}</p>
                </th>
              </tr>
              <tr>
                <th class="font-weight-bold">
                  <p class="m-0 week-block">{{ totalData.mlTotal }}</p>
                </th>
              </tr>
              <tr>
                <th class="font-weight-bold">
                  <p class="m-0 week-block">{{ totalData.apoTotal }}</p>
                </th>
              </tr>
              <tr>
                <th class="font-weight-bold">
                  <p class="m-0 week-block">{{ totalData.actuals }}</p>
                </th>
              </tr>
              <tr>
                <th class="font-weight-bold">
                  <p class="m-0 week-block">{{ totalData.lastYearTotal }}</p>
                </th>
              </tr>
            </table>
          </div>
        </div>
        <div class="p-2 text-center">
          <a href="javascript:void(0);" class="btn btn-primary custom-link btn-xs" data-toggle="modal"
             data-target="#saveAPlansModal">Save Plan</a>
          <a href="javascript:void(0);" class="btn btn-primary custom-link btn-xs ml-1" data-toggle="modal"
             data-target="#saveAViewsModal">Save View</a>
        </div>
      </div>
    </div>
  </div>
  <div class="events-col pt-1 pb-3 pl-2 pr-2">
    <div class="events-container shadow mt-1 mb-1 p-2 bg-white" data-simplebar>
      <!-- <div class="mt-2">
        <h4>Features</h4>
        <div class="m-1 p-1 d-flex">
          <div>
            <input class="mr-1" type="checkbox">
          </div>
          <p class="m-0">Promo Effect</p>
        </div>
        <div class="m-1 p-1 d-flex">
          <div>
            <input class="mr-1" type="checkbox">
          </div>
          <p class="m-0">Weather Effect</p>
        </div>

      </div> -->

      <div class="mt-2" *ngIf="selectedWeekComments.length">
        <h4>Comments</h4>
        <div class="block m-1 p-1 d-flex" *ngFor="let selectedWeekComment of selectedWeekComments">
          <p class="m-0 text-break">{{ selectedWeekComment }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Select Options Modal-->
<a href="javascript:void(0);" [hidden]="true" data-target="#selectOptionsModal" data-toggle="modal"
   #selectOptionsModalBtn>Open Options Modal</a>
<div class="modal select-options-modal" id="selectOptionsModal" tabindex="-1" role="dialog" data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                [class.invisible]="!graphData.length" #selectOptionsModalCancel>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <app-create-plan [events]="eventsSubject.asObservable()"
                         (submit)="eventListener($event)"></app-create-plan>
      </div>
    </div>
  </div>
</div>

<!--Save a Plan Modal-->
<a href="javascript:void(0);" [hidden]="true" data-target="#saveAPlansModal" data-toggle="modal" #saveAPlansModalBtn>Save
  a Plan Modal</a>
<div class="modal fade save-plan-modal" id="saveAPlansModal" tabindex="-1" role="dialog" data-backdrop="static"
     aria-labelledby="saveAPlansModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Save the Plan</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #PlanNameModalBtn><span
          aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <div class="d-flex justify-content-center">
          <button type="button" (click)="savePlan()" class="btn btn-secondary custom-link btn-xs mr-2">Yes
            <ng-container *ngIf="savePlanLoader">
              <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
            </ng-container>
          </button>
          <button type="button" data-dismiss="modal" aria-label="Close" class="btn btn-secondary custom-link btn-xs">No</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Save View modal-->
<a href="javascript:void(0);" [hidden]="true" data-target="#saveAViewsModal" data-toggle="modal" #saveAViewsModalBtn>Save
  a View Modal</a>
<div class="modal fade save-plan-modal" id="saveAViewsModal" tabindex="-1" role="dialog" data-backdrop="static"
     aria-labelledby="saveAViewsModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Save the View</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #ViewNameModalBtn><span
          aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <form #saveViewForm="ngForm">
          <input type="text" class="form-control" id="viewName" name="viewName" placeholder="Please enter the view Name"
                 #saveViewName ngModel required>
          <p class="text-center mt-4">
            <button type="submit" [disabled]="!saveViewForm.valid" (click)="saveView(saveViewName.value)"
                    class="btn btn-secondary custom-link btn-xs" [class.disabled]="!saveViewForm.valid">Ok
              <ng-container *ngIf="saveViewLoader">
                <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
              </ng-container>
            </button>
          </p>
        </form>
      </div>
    </div>
  </div>
</div>

<!--Graph Comment Modal-->
<a href="javascript:void(0);" [hidden]="true" data-target="#commentFormModal" data-toggle="modal" #commentFormModalBtn>Open
  Graph Comment Form Modal</a>
<div class="modal fade comment-modal" id="commentFormModal" tabindex="-1" role="dialog" data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Comment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #commentFormModalCancel>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #commentForm="ngForm">
          <div class="form-group">
            <label class="d-none" for="comment">
              Comment
            </label>
            <input type="text" class="form-control" id="comment" name="comment" placeholder="eg. Comment" ngModel
                   required>
          </div>
          <button type="submit" class="btn float-right btn-secondary" [disabled]="!commentForm.valid"
                  [ngClass]="{'disabled': !commentForm.valid}"
                  (click)="onCommentFormSubmit(commentForm,commentForm.value)">Submit
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!--Final Forecast Comment Modal-->
<a href="javascript:void(0);" [hidden]="true" data-target="#finalForecastCommentModal" data-toggle="modal"
   #finalForecastCommentModalBtn>Open Graph Comment Form Modal</a>
<div class="modal fade final-comment-modal" id="finalForecastCommentModal" tabindex="-1" role="dialog"
     data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Comment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #finalForecastCommentModalCancel
                (click)="selectedWeekIndex=null;finalForecastCommentForm.resetForm()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #finalForecastCommentForm="ngForm">
          <div class="form-group">
            <label class="d-none" for="finalForecastComment">
              Comment
            </label>
            <input type="text" class="form-control" id="finalForecastComment" name="comment" placeholder="eg. Comment"
                   ngModel required>
          </div>
          <button type="submit" class="btn float-right btn-dark" [disabled]="!finalForecastCommentForm.valid"
                  [ngClass]="{'disabled': !finalForecastCommentForm.valid}"
                  (click)="onFinalForecastCommentSubmit(finalForecastCommentForm.value)">Submit
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!--Save Filter Modal-->
<a href="javascript:void(0);" [hidden]="true" data-target="#saveFilterModal" data-toggle="modal" #saveFilterModal>Open
  Save Filter Modal</a>
<div class="modal fade save-filter-modal" id="saveFilterModal" tabindex="-1" role="dialog" data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Save Filter</h5>
        <button type="button" class="close invisible" data-dismiss="modal" aria-label="Close" #saveFilterModalCancel>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #saveFilterModalForm="ngForm">
          <div>
            <div class="form-group">
              <label for="filterName">
                <span>Filter Name</span>
              </label>
              <input type="text" class="form-control" id="filterName" name="filterName" #filterName ngModel
                     placeholder="eg. Green Bottles" required>
            </div>
          </div>
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
              Cancel
            </button>
            <button type="submit" class="btn btn-dark" [disabled]="!filterName.value"
                    [ngClass]="{'disabled': !filterName.value}"
                    (click)="saveFilter(filterName.value)">Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!--Load Filter Modal-->
<a href="javascript:void(0);" [hidden]="true" data-target="#loadFilterModal" data-toggle="modal" #loadFilterModal>Open
  Load Filter Modal</a>
<div class="modal fade load-filter-modal" id="loadFilterModal" tabindex="-1" role="dialog" data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Organize your Filters</h5>
        <button type="button" class="close invisible" data-dismiss="modal" aria-label="Close" #loadFilterModalCancel>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #saveFilterModalForm="ngForm">

          <ng-container *ngFor="let filter of loadedFilters;let i=index">
            <div class="filter-item shadow-sm cursor-pointer" [class.selected]="filter.isSelected"
                 (click)="filterItemClick(i)">
              {{ i + 1 }}<span> {{ filter.name }}</span>
            </div>
          </ng-container>

          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-dark" (click)="loadSelectedFilter()">Load Selected</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
